https://www.youtube.com/watch?v=c5ExGryXXos
https://habrahabr.ru/company/jugru/blog/341944/

==============================

Почему не пишем тесты на тесты.
Потому что считается. что тесты очень простые и понятные.
Накосячить в тесте сложнее.

Интеграционные тесты и E2E - посложнее поддерживать, т.к. они ломаются не из за одного места, а из-за нескольких.

оПисать done.

Название важно.

Тесты - документация.
Безопасный рефакторинг.
Безопасное изменение проекта, значит и развитие.

Rich Hickey "Simple Made Easy".

В тестах хорошо бы отвязывать.

Тест - передача входных данных и проверка выходных и побочных эффектов.

Значит нужен контроль над всеми входами, выходами, и возможности проверки сайд-эффектов.
Побочные эффекты - неявные входы и выходы.

==============================

3 правила тестируемого кода.

# Ф-ю тестировать просто, если все входы и выходы явные.

# Если явно передавать зависимости модулю.

Модуль это как бы ф-я, которая растянута во времени. И передача входных и вывод выходных параметров,
идёт в разные моменты времени.

# Контролировать заменяемость зависимостей в тестах.

Боевые и тестовые зависимости должны иметь один интерфейс.

Синглтоны и Статические штуки плохо сочетаются с тестами.

Ф-и, на которые мы не можем повлиять. random, date.
Всё это имеет смысл выносить за интерфейс.

Файлы. Часто нужно знать был файл или нет.
И какая точно ошибка если файл не создался.
SecurityException
IOException.

Создание файла - сайд эффект.
Пресеты с пермишнсами.
Не хочется делать напрямую на файловой системе.
Хорошо бы мокировать файловые интерфейсы.

Все юнит тесты должны проходить за полминуты.

Хорошо бы контролировать время. Интервалы и таймстемпы.
Т.е. всю работу со временем - за интерфейс.
И получится, что вся работа со временем через одну точку в вашей архитектуре.

Форматирование и локаль.
Форматы чисел, валюта, локаль, таймзона и т.д.

==============================


# Mocking.

Интерфейсы - серебряная пуля.


Даже синглтон может наследоваться от интерфейса.
И в есте можно его менять. Т.е. передавать другой наследник этого интерфейса как явную зависимость.

Что за модули EDI ?


Получается что статики и final классы - это плохой дизайн ??




Бэк энд.
Third Party вызовы - прячем за обертки, наследованные от интерфейсов.
Дальше интерфейс идет как явная зависимость.


Обертки можно сделать под себя.

Можно разделить интерфейсы, взаимодейстсвующие с одним и тем же 3rd party API.
ISP (Interface Segregation Principle).



Доступ к платформенным ресурсам.


===================================


Начинаем с модлей, платформенные обертки.

==============================

==============================

Модель от бд - должна быть отделена интерфейсом.
Т.е. должны быть две имплементации интерфейса - первая это БД, вторая - мок слой для тестов.

==============================

https://www.youtube.com/watch?v=Y76-u18NEKI


Юнит тесты. Регулярно и автоматически.

Для отслеживания регрессий.

Юнит - отдельная функция или класс.
Отдельно от остальных частей системы.

Чем быстрее нашли ошибку, тем меньше времени тратится на фикс.

Юнит тесты - примеры применения кода.
Как бы документация.


Юнит тест должно быть просто читать.

Понятные имена.

Проверять что-то одно.

Не должен иметь внешних зависимостей.


НЕ надо универсального конфига для теста.
В тест передаем только то, что используется.
@@Хотя, можно и за интерфейсом общим спрятать.

 
Тестовая зависимость - как доп. параметр, который не используется в боевом режиме.






https://www.youtube.com/watch?v=Ag01GJOSKb4

# Почему Юнит тесты не рабтают.


У интеграционных тестов были нечитабельные логи.

 
Они сделали прослойку между UI и другими модулями.
Запоминают действия пользователя. Пишут их в файл.
Затем, есть возможность воспроизвести.

Но как туда встроить проверки ??

Круто, пользователь может записать и прислать запись.

Для всяких тестов - классно.
Можно так пресеты заносить.

Воо, чувак на легаси системе предлагает начинать с GUI тестов, начинать сверху пирамиды, чтобы 
безопасно делать низ пирамиды.

Обязательно вовлекать разработчиков.

Все разрабы должны легко запускать тесты.

Следить за ними.

Запрещать вливать в мастер не зеленые тесты.
Запрещается вливать в мастер код, для которого тесты красные.


Вы будете писать юнит тесты.
Другие люди будут их ломать, и им на это будет плевать.

Нужно собраться всем вместе и договориться, что следим за тестами.
Поддерживаем их.


https://habrahabr.ru/post/169381/



Хорошая обзорная лекция для новичков в тестировании.
https://www.youtube.com/watch?v=KAny2OSYY3Y



Тесты пишутся для каждой нетривиальной функции или метода.
*Не надо писать юнит тесты на геттеры и сеттеры.*

Цель - изолировать отельные части программы, и показать что по отдельности они работают.


Что нужно тестировать ? - То, что должно работать.

При тестировании "белого ящика" - думай как программист.
При тестировании "черного ящика" - думай как тестировщик.




Хороший программист не должен запускать дебаг.

Должны быть юнит тесты и трейсинг.


# TDD

TDD хорош, когда задачка непонятна сходу.

все тесты заленые, знач код закончен.

запускать тест, когда ничего нет - принципиально. Вдруг ошибка в тесте.

Послений этап - рефакторинг.

# Mock - (от пародия, имитация).

Стаб - ничего не делает.
Мок - делает.




========================

# REST

* Важно чтобы методы занимались тем, чем положено.
Get, Post, Put, Delete.

* Важно, чтобы возвращался правильный код статуса.

* Формат ошибки. Ошибка может содержать подсказку, откуда в сорцах она возникла.

* Curl, Postman, SoapUI, JsonView.

* Возможно SoapUI может помогать в генерации автотестов для RestAPI.

* 

===================================

# https://www.youtube.com/watch?v=AlxMGxs2QnM

Синглтон - плохо.

MVP

DI - все зависимости снаружи.

=======

# UI (View, Presenter)

Presenter - управляет вьюхой.

# Business

Interactors. - логика.
Модели в БД и в UI - разные. Интеракторы преобразуют.

# Data - Абстракция - репозиторий. Прослойка между логикой и черновыми классами.
Репозиторий пробрасывает ошибки наверх.

Репозитории не общаются друг с другом.



Хорошая статья про sinon.js.
https://habrahabr.ru/company/ua-hosting/blog/274317/








